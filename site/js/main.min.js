let ENV_CANDIDATES=["public/env/test.hdr","assets/HDRI_8K_001.exr"],preloadedEnvUrl=null,smoother,threeJSCleanup=null,isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches;function initScrollSmoother(){gsap.registerPlugin(ScrollTrigger,ScrollSmoother),smoother=ScrollSmoother.create({wrapper:"#smooth-wrapper",content:"#smooth-content",smooth:prefersReducedMotion?0:isMobile?.8:1.5,effects:!isMobile,smoothTouch:isMobile?.05:.1,normalizeScroll:!isMobile,ignoreMobileResize:!0}),ScrollTrigger.config({limitCallbacks:!0,syncInterval:isMobile?150:50}),isMobile&&ScrollTrigger.defaults({markers:!1,scrub:!0}),console.log("ScrollSmoother initialized")}function preloadEnvNetwork(){let e=async(t=0)=>{if(t>=ENV_CANDIDATES.length)return;let o=ENV_CANDIDATES[t];try{let r=await fetch(o,{method:"GET",mode:"cors"});if(r.ok){await r.arrayBuffer(),preloadedEnvUrl=o;return}}catch(n){}return e(t+1)};e()}function lazyInitThreeJS(){let e=document.querySelector(".about-center-content");if(!e){console.error(".about-center-content not found");return}let t=window.innerWidth<=480;if(t){e.querySelectorAll("canvas").forEach(e=>e.remove());let o=document.createElement("img");o.src="assets/ahy-logo.webp",o.alt="AHY Logo",o.className="logo-fallback",e.appendChild(o);let r=document.createElement("div");r.className="logo-overlay",e.appendChild(r);let n=document.getElementById("progress-container");n&&(n.style.display="none"),document.dispatchEvent(new CustomEvent("3dModelLoaded")),document.dispatchEvent(new CustomEvent("hdrEnvLoaded")),threeJSCleanup=()=>{r.remove(),o.remove()};return}let i=async()=>{let[e,t,o,r,n,i]=await Promise.all([import("three"),import("three/addons/loaders/GLTFLoader.js"),import("three/addons/loaders/DRACOLoader.js"),import("three/addons/controls/OrbitControls.js"),import("three/addons/loaders/RGBELoader.js"),import("three/addons/loaders/EXRLoader.js"),]);initThreeJS({THREE:e,GLTFLoader:t.GLTFLoader,DRACOLoader:o.DRACOLoader,OrbitControls:r.OrbitControls,RGBELoader:n.RGBELoader,EXRLoader:i.EXRLoader})},a=!1;document.addEventListener("force3DInit",()=>{a||(a=!0,i())},{once:!0});let l=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&!a&&(a=!0,i(),l.disconnect())})},{rootMargin:isMobile?"400px 0px":"800px 0px"});l.observe(e),a||isMobile||(a=!0,i())}function initThreeJS({THREE:e,GLTFLoader:t,DRACOLoader:o,OrbitControls:r,RGBELoader:n,EXRLoader:i}){let a=document.querySelector(".about-center-content");if(!a)return;let l={env:{intensity:1.5,rotationY:0},ambientIntensity:.25,hemisphere:{sky:16777215,ground:2236979,intensity:.35},directionalIntensity:.6,toneExposure:1,materialDefaults:{metalness:.9,roughness:.15}},s=new e.WebGLRenderer({antialias:!1,alpha:!0,powerPreference:isMobile?"low-power":"high-performance",stencil:!1,depth:!0,logarithmicDepthBuffer:!1});s.setPixelRatio(Math.min(window.devicePixelRatio,isMobile?1:1.5)),s.setSize(a.clientWidth,a.clientHeight),s.outputColorSpace=e.SRGBColorSpace,s.toneMapping=e.ACESFilmicToneMapping,s.toneMappingExposure=l.toneExposure,a.appendChild(s.domElement),window.ScrollTrigger&&ScrollTrigger.refresh();let d=new e.Scene,c=new e.PerspectiveCamera(45,a.clientWidth/a.clientHeight,1,100);c.position.set(4,3,9);let p=isMobile?2.5:1,m=new e.AmbientLight(16777215,l.ambientIntensity*p);d.add(m);let h=new e.HemisphereLight(l.hemisphere.sky,l.hemisphere.ground,l.hemisphere.intensity*p);d.add(h);let $=new e.DirectionalLight(16777215,l.directionalIntensity*p);if($.position.set(10,10,10),d.add($),isMobile){let u=new e.DirectionalLight(16777215,.4);u.position.set(-10,5,-10),d.add(u);let g=new e.DirectionalLight(16777215,.3);g.position.set(0,-5,10),d.add(g)}let f=new r(c,s.domElement);f.enableDamping=!0,f.dampingFactor=.05,f.enableRotate=!1,f.enableZoom=!1,f.enablePan=!1,f.target.set(0,1,0),f.update();let v=new e.PMREMGenerator(s);v.compileEquirectangularShader(),v.compileCubemapShader&&v.compileCubemapShader();let E=ENV_CANDIDATES,b=e=>{let t=v.fromEquirectangular(e).texture;d.environment=t,d.background=null,e.dispose();try{d.traverse(e=>{e&&e.isMesh&&e.material&&("number"==typeof e.material.envMapIntensity&&(e.material.envMapIntensity=l.env.intensity),e.material.needsUpdate=!0)})}catch(o){console.warn("Material refresh after HDR set failed:",o)}V=!0,document.dispatchEvent(new CustomEvent("hdrEnvLoaded"));try{S&&!C&&(s.compile(d,c),C=!0)}catch(r){}},y=(e=0)=>{if(e>=E.length){console.warn("No HDR/EXR env map loaded. Checked:",E),V=!0,document.dispatchEvent(new CustomEvent("hdrEnvLoaded"));return}let t=E[e],o=t.split(".").pop().toLowerCase(),r=()=>y(e+1);"hdr"===o?new n().load(t,b,void 0,r):"exr"===o?new i().load(t,b,void 0,r):y(e+1)};if(isMobile)V=!0,document.dispatchEvent(new CustomEvent("hdrEnvLoaded"));else if(preloadedEnvUrl&&E.includes(preloadedEnvUrl)){let w=E.indexOf(preloadedEnvUrl);y(w)}else y(0);let M=new o;M.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),M.setDecoderConfig({type:isMobile?"js":"wasm"});let _=new t().setPath("public/logo/");_.setDRACOLoader(M);let L=null,S=!1,C=!1,R=0,x=0,D=0,A=1,I=-69*Math.PI/180,T={targetX:0,targetY:0,currentX:0,currentY:0,maxX:.25,maxY:.4,ease:.1},X={amplitude:.08,speed:.8,rotAmp:.03};_.load("ahy_logo.glb",e=>{(L=e.scene).position.set(0,1,0);let t=1;window.innerWidth<=480?t=.7:window.innerWidth<=786&&(t=.75),L.scale.set(t,t,t),L.traverse(e=>{e.isMesh&&(e.material&&(isMobile?(e.material.metalness=.6,e.material.roughness=.35):(e.material.metalness=l.materialDefaults.metalness,e.material.roughness=l.materialDefaults.roughness,e.material.envMapIntensity=l.env.intensity,"envMapRotation"in e.material&&e.material.envMapRotation&&e.material.envMapRotation.set(0,l.env.rotationY,0)),e.material.needsUpdate=!0),!isMobile&&e.geometry&&e.geometry.computeBoundingSphere(),e.frustumCulled=!0,e.castShadow=!isMobile,e.receiveShadow=!isMobile)}),d.add(L),S=!0,R=L.rotation.x,x=L.rotation.y,D=L.rotation.z,A=L.position.y;let o=document.getElementById("progress-container");o&&(o.style.display="none"),document.dispatchEvent(new CustomEvent("3dModelLoaded")),window.ScrollTrigger&&(isMobile?setTimeout(()=>ScrollTrigger.refresh(),100):requestAnimationFrame(()=>ScrollTrigger.refresh()))},e=>{let t=e.loaded/e.total*100;console.log(`Loading: ${t.toFixed(2)}%`)},e=>{console.error("Error loading model:",e),document.dispatchEvent(new CustomEvent("3dModelLoaded"))});let N,Y=()=>{clearTimeout(N),N=setTimeout(()=>{c.aspect=a.clientWidth/a.clientHeight,c.updateProjectionMatrix(),s.setSize(a.clientWidth,a.clientHeight)},150)};window.addEventListener("resize",Y);let P=(e,t)=>{let o=a.getBoundingClientRect(),r=(e-o.left)/o.width*2-1,n=(t-o.top)/o.height*2-1;T.targetY=r*T.maxY,T.targetX=-n*T.maxX},k=e=>P(e.clientX,e.clientY),B=()=>{T.targetX=0,T.targetY=0},z=e=>{let t=a.getBoundingClientRect(),o=e.clientX,r=e.clientY,n=o>=t.left&&o<=t.right&&r>=t.top&&r<=t.bottom;n?P(o,r):(T.targetX=0,T.targetY=0)},G=()=>{T.targetX=0,T.targetY=0},j=e=>{if(!e.touches||0===e.touches.length)return;let t=e.touches[0];P(t.clientX,t.clientY)},H=()=>{T.targetX=0,T.targetY=0},O=window.matchMedia("(hover: hover) and (pointer: fine)").matches;if(O){let U=[s.domElement,a];U.forEach(e=>{e&&(e.addEventListener("pointermove",k,{passive:!0}),e.addEventListener("pointerleave",B,{passive:!0}))}),window.addEventListener("pointermove",z,{passive:!0}),window.addEventListener("pointerout",G,{passive:!0}),s.domElement.style.pointerEvents="auto",s.domElement.style.touchAction="none"}else s.domElement.style.pointerEvents="none",s.domElement.style.touchAction="auto";let W,J=0,F=1e3/(isMobile?30:60),q=!1,V=!1;!function e(t){if(W=requestAnimationFrame(e),isMobile){let o=t-J;if(o<F)return;J=t-o%F}if(f.update(),L&&S){T.currentX+=(T.targetX-T.currentX)*T.ease,T.currentY+=(T.targetY-T.currentY)*T.ease,L.rotation.x=R+T.currentX,L.rotation.y=x+I+T.currentY;let r=t/1e3*X.speed*Math.PI*2;L.position.y=A+Math.sin(r)*X.amplitude,L.rotation.z=D+Math.sin(r+Math.PI/2)*X.rotAmp}if(s.render(d,c),S&&V&&!C){try{s.compile(d,c)}catch(n){}C=!0}if(!q&&S&&V){q=!0;let i=0,a=()=>{++i<2?requestAnimationFrame(a):document.dispatchEvent(new CustomEvent("3dFirstFrameRendered"))};requestAnimationFrame(a)}}(0),threeJSCleanup=()=>{cancelAnimationFrame(W),window.removeEventListener("resize",Y),[s.domElement,a].forEach(e=>{e&&(e.removeEventListener("pointermove",k),e.removeEventListener("pointerleave",B),e.removeEventListener("touchmove",j),e.removeEventListener("touchend",H))}),window.removeEventListener("pointermove",z),window.removeEventListener("pointerout",G),L&&(L.traverse(e=>{e.isMesh&&(e.geometry?.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose()))}),d.remove(L),L=null),d.traverse(e=>{e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose())}),v.dispose?.(),s.dispose(),f.dispose(),M.dispose(),s.domElement&&s.domElement.parentNode&&s.domElement.parentNode.removeChild(s.domElement),console.log("Three.js cleaned up")}}document.addEventListener("componentsLoaded",()=>{console.log("All components loaded"),initScrollSmoother(),isMobile||(preloadEnvNetwork(),warmDracoNetwork(),preloadModelNetwork()),lazyInitThreeJS(),initIntroPinWithAboutUs()}),window.addEventListener("beforeunload",()=>{threeJSCleanup&&threeJSCleanup(),smoother&&smoother.kill()});function initIntroPinWithAboutUs(){if(!window.gsap||!window.ScrollTrigger)return;let e=document.querySelector(".intro"),t=document.querySelector(".about-scroll-container");e&&t&&(ScrollTrigger.create({trigger:e,start:"top top",endTrigger:t,end:"top top",pin:!0,pinSpacing:!1,scrub:!0,pinnedContainer:"#smooth-content"}),gsap.to(e,{opacity:1,scrollTrigger:{trigger:t,start:"top bottom",end:"top top",scrub:!0,pinnedContainer:"#smooth-content",onUpdate(t){e.style.opacity=1-t.progress,t.progress>.1?e.style.pointerEvents="none":e.style.pointerEvents=""}}}),gsap.fromTo(t,{opacity:0},{opacity:1,scrollTrigger:{trigger:t,start:"top bottom",end:"top top",scrub:!0,pinnedContainer:"#smooth-content"}}),requestAnimationFrame(()=>ScrollTrigger.refresh()))}function warmDracoNetwork(){let e="https://www.gstatic.com/draco/versioned/decoders/1.5.6/";isMobile?fetch(e+"draco_decoder.js").catch(()=>{}):(fetch(e+"draco_wasm_wrapper.js").catch(()=>{}),fetch(e+"draco_decoder.wasm").catch(()=>{}))}function preloadModelNetwork(){fetch("public/logo/ahy_logo.glb",{method:"GET",mode:"cors"}).then(e=>e&&e.ok?e.arrayBuffer():null).catch(()=>{})}export{smoother};